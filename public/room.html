const socket=io();

const token=document.getElementById("player");
const dice=document.getElementById("dice");
const hypeText=document.getElementById("hype");
const rollBtn=document.getElementById("rollBtn");

function sleep(ms){
return new Promise(r=>setTimeout(r,ms));
}

/* –¢–í–û–ò –ò–î–ï–ê–õ–¨–ù–´–ï –ö–û–û–†–î–ò–ù–ê–¢–´ */

const CELLS=[
{x:108,y:599},
{x:110,y:456},
{x:116,y:359},
{x:105,y:238},
{x:110,y:127},
{x:235,y:97},
{x:354,y:105},
{x:500,y:99},
{x:641,y:97},
{x:793,y:91},
{x:912,y:127},
{x:909,y:246},
{x:912,y:345},
{x:903,y:456},
{x:909,y:575},
{x:798,y:608},
{x:638,y:591},
{x:489,y:605},
{x:340,y:588},
{x:210,y:608},
{x:124,y:633}
];

let position=0;

function moveToCell(pos){
const cell=CELLS[pos%CELLS.length];
token.style.left=cell.x+"px";
token.style.top=cell.y+"px";
}

async function stepMove(steps){
for(let i=0;i<steps;i++){
position++;
moveToCell(position);
await sleep(300);
}
}

rollBtn.onclick=()=>{
socket.emit("rollDice");
};

socket.on("diceRolled",async(data)=>{

dice.style.transform=
`rotateX(${Math.random()*720}deg)
 rotateY(${Math.random()*720}deg)`;

await stepMove(data.dice);

hypeText.innerText="HYPE: "+data.hype;
});

socket.on("winner",()=>{
alert("üî• –ü–û–ë–ï–î–ê! HYPE = 100");
});

moveToCell(0);
